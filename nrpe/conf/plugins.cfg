{% from "nrpe/map.jinja" import nrpe with context %}

{% set config = {
  'pidfile': nrpe.server.pidfile,
  'port': salt['pillar.get']('nrpe:server:config:port', nrpe.server.port),
  'user': salt['pillar.get']('nrpe:server:config:user', nrpe.server.user),
  'group': salt['pillar.get']('nrpe:server:config:group', nrpe.server.group),
  'allowedhosts': salt['pillar.get']('nrpe:server:config:allowedhosts', nrpe.server.allowedhosts),
  'dbn': salt['pillar.get']('nrpe:server:config:dbn', False), 
  'debug': salt['pillar.get']('nrpe:server:config:debug', False), 
} %}

log_facility=daemon
pid_file={{ config.pidfile }}
server_port={{ config.port ]}
nrpe_user={{ config.user }}
nrpe_group={{ config.group }}
allowed_hosts={{ config.allowedhosts }}

dont_blame_nrpe={{ config.dbn }}
allow_bash_command_substitution=0
debug={{ config.debug }}
command_timeout={{ config.commandtimeout }}
connection_timeout={{ config.connectiontimeout }}
command[check_users]=/usr/lib64/nagios/plugins/check_users -w 5 -c 10
command[check_load]=/usr/lib64/nagios/plugins/check_load -w 15,10,5 -c 30,25,20
command[check_hda1]=/usr/lib64/nagios/plugins/check_disk -w 20% -c 10% -p /dev/hda1
command[check_zombie_procs]=/usr/lib64/nagios/plugins/check_procs -w 5 -c 10 -s Z
command[check_total_procs]=/usr/lib64/nagios/plugins/check_procs -w 150 -c 200
include_dir={{ config.includedir }}
